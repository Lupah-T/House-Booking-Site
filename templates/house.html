{% extends "layout.html" %}

{% block title %}MUT Housing - Available Properties{% endblock %}

{% block content %}
<div class="mb-10 animate-fade-in">
  <h1 class="text-4xl font-extrabold text-[#003366] mb-2 uppercase italic tracking-tight">Available Student Housing</h1>
  <p class="text-gray-500 font-medium">Browse verified rooms near Murang'a University campus.</p>
</div>

<!-- Search & Filtering Section -->
<div class="glass-card p-8 rounded-2xl mb-12 border-t-4 border-[#003366] bg-white shadow-xl">
  <form action="/house" method="GET" class="grid grid-cols-1 md:grid-cols-4 gap-6">
    <!-- Search -->
    <div class="relative">
      <label class="block text-xs font-black text-[#003366] uppercase mb-2">Search Name</label>
      <div class="relative">
        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
        <input type="text" name="search" value="{{ search or '' }}" placeholder="Property name..."
          class="input-field pl-12 text-sm">
      </div>
    </div>

    <!-- House Type -->
    <div>
      <label class="block text-xs font-black text-[#003366] uppercase mb-2">Room Type</label>
      <select name="type" class="input-field text-sm">
        <option value="Any" {% if current_type=='Any' or not current_type %}selected{% endif %}>All Types</option>
        <option value="Single Room" {% if current_type=='Single Room' %}selected{% endif %}>Single Room</option>
        <option value="Double Room" {% if current_type=='Double Room' %}selected{% endif %}>Double Room</option>
        <option value="Bedsitter" {% if current_type=='Bedsitter' %}selected{% endif %}>Bedsitter</option>
        <option value="1 Bedroom" {% if current_type=='1 Bedroom' %}selected{% endif %}>1 Bedroom</option>
        <option value="2 Bedroom" {% if current_type=='2 Bedroom' %}selected{% endif %}>2 Bedroom</option>
      </select>
    </div>

    <!-- Location -->
    <div>
      <label class="block text-xs font-black text-[#003366] uppercase mb-2">Campus Area</label>
      <select name="location" class="input-field text-sm">
        <option value="Any" {% if current_location=='Any' or not current_location %}selected{% endif %}>All Areas
        </option>
        <option value="Mukuyu" {% if current_location=='Mukuyu' %}selected{% endif %}>Mukuyu</option>
        <option value="Town" {% if current_location=='Town' %}selected{% endif %}>Town</option>
        <option value="Tities" {% if current_location=='Tities' %}selected{% endif %}>Tities</option>
        <option value="VM" {% if current_location=='VM' %}selected{% endif %}>VM</option>
        <option value="Mangaza" {% if current_location=='Mangaza' %}selected{% endif %}>Mangaza</option>
        <option value="Pioneer" {% if current_location=='Pioneer' %}selected{% endif %}>Pioneer</option>
        <option value="Maingate road" {% if current_location=='Maingate road' %}selected{% endif %}>Maingate road
        </option>
        <option value="Umoja" {% if current_location=='Umoja' %}selected{% endif %}>Umoja</option>
        <option value="Kayole" {% if current_location=='Kayole' %}selected{% endif %}>Kayole</option>
        <option value="MCW" {% if current_location=='MCW' %}selected{% endif %}>MCW</option>
        <option value="Katiba" {% if current_location=='Katiba' %}selected{% endif %}>Katiba</option>
      </select>
    </div>

    <!-- Submit -->
    <div class="flex items-end">
      <button type="submit" class="w-full btn-primary h-[50px] shadow-md">Apply Filters</button>
    </div>
  </form>
</div>

<!-- Results Grid -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-20 animate-fade-in">
  {% if houses %}
  {% for house in houses %}
  <div class="glass-card flex flex-col overflow-hidden bg-white border-b-4 border-[#003366]">
    <!-- Status Badge -->
    <div class="absolute top-4 left-4 z-10">
      <span class="px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest shadow-lg
                    {% if house.availability == 'Vacant' %}badge-vacant{% else %}badge-booked{% endif %}">
        {{ house.availability }}
      </span>
    </div>

    <!-- Image Area -->
    <div class="h-48 bg-gray-200 relative overflow-hidden group">
      {% if house.image_filename %}
      <img src="{{ url_for('static', filename='images/' + house.image_filename) }}" alt="{{ house.name }}"
        class="w-full h-full object-cover group-hover:scale-110 transition duration-500">
      {% else %}
      <div class="w-full h-full flex items-center justify-center bg-[#f0f4f8]">
        <i class="fas fa-university text-5xl text-[#003366] opacity-10"></i>
      </div>
      {% endif %}
      <div class="absolute bottom-0 right-0 bg-[#003366] text-[#FFCC00] px-4 py-2 font-black text-sm">
        Ksh {{ house.price }}
      </div>
    </div>

    <div class="p-6 flex-grow flex flex-col">
      <div class="flex items-center gap-2 text-[10px] font-black text-[#FFCC00] uppercase mb-1">
        <i class="fas fa-tag"></i>
        {{ house.house_type }}
      </div>
      <h3 class="text-lg font-bold text-[#003366] mb-3 leading-tight">{{ house.name }}</h3>
      <div class="flex items-center gap-2 text-gray-500 text-xs font-semibold mb-4 bg-[#f8fafc] p-2 rounded">
        <i class="fas fa-map-marker-alt text-[#003366]"></i>
        {{ house.location }}
      </div>

      <div class="mt-auto pt-4 border-t border-gray-100 flex items-center justify-between">
        <div class="text-[10px] text-gray-400 font-bold uppercase">
          <i class="fas fa-phone-alt mr-1"></i> {{ house.contact }}
        </div>
        {% if house.availability == 'Vacant' %}
        <a href="/booking?house_id={{ house.id }}"
          class="text-[#003366] font-black text-xs hover:text-[#FFCC00] transition flex items-center gap-1 uppercase">
          Book Now <i class="fas fa-arrow-right"></i>
        </a>
        {% else %}
        <span class="text-red-400 font-bold text-[10px] uppercase">Fully Booked</span>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
  {% else %}
  <div class="col-span-full py-20 text-center">
    <i class="fas fa-search text-6xl text-gray-200 mb-6"></i>
    <h3 class="text-xl font-bold text-[#003366] opacity-50 uppercase">No property matched your search criteria</h3>
    <a href="/house"
      class="text-gray-500 hover:text-[#003366] font-bold text-sm mt-4 inline-block underline decoration-[#FFCC00] underline-offset-4">Reset
      Search Filters</a>
  </div>
  {% endif %}
</div>
{% endblock %}